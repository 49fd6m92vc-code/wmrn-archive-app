<script>
document.addEventListener("DOMContentLoaded", () => {
  const grid = document.getElementById("photoGrid");

  if (!grid) {
    console.error("photoGrid not found");
    return;
  }

  const OWNER = "49fd6m92vc-code";
  const REPO = "wmrn-archive-app";
  const PATH = "Photos";

  const apiURL = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}`;

  fetch(apiURL)
    .then(res => {
      if (!res.ok) {
        throw new Error("GitHub API request failed");
      }
      return res.json();
    })
    .then(files => {
      const images = files.filter(file =>
        file.type === "file" &&
        /\.(jpg|jpeg|png)$/i.test(file.name)
      );

      if (images.length === 0) {
        grid.innerHTML = "<p class='muted'>No photos found.</p>";
        return;
      }

      images.forEach(file => {
        const filename = file.name;
        const title = filename
          .replace(/\.(jpg|jpeg|png)$/i, "")
          .replace(/_/g, " ");

        const link = document.createElement("a");
        link.href = `/wmrn-archive-app/item.html?file=${encodeURIComponent(filename)}`;
        link.className = "photo-card";

        const img = document.createElement("img");
        img.src = file.download_url;
        img.alt = title;
        img.loading = "lazy";

        const meta = document.createElement("p");
        meta.className = "photo-meta";
        meta.textContent = "WMRN Radio History Archive";

        const caption = document.createElement("p");
        caption.className = "photo-caption";
        caption.textContent = title;

        link.appendChild(img);
        link.appendChild(meta);
        link.appendChild(caption);
        grid.appendChild(link);
      });
    })
    .catch(err => {
      console.error(err);
      grid.innerHTML = "<p class='muted'>Unable to load photos.</p>";
    });
});
</script>